# Build the test env app on EAS Cloud service.
name: 'Build | Test'
run-name: Build | Test for ${{ inputs.platform }}
on:
  workflow_dispatch:
    inputs:
      platform:
        type: choice
        description: Which platform to build for
        options:
          - ios
          - android
        required: true
jobs:
  # build:
  #   name: "Build (test / ${{ github.event.inputs.platform }})"
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: ‚¨áÔ∏è Setup repo
  #       uses: actions/checkout@v3

  #     - name: ‚éî Setup Node
  #       uses: actions/setup-node@v3
  #       with:
  #         node-version: 18.x
  #         cache: npm
  #         cache-dependency-path: ./package.json

  #     - name: üèó Setup EAS
  #       uses: expo/expo-github-action@v8
  #       with:
  #         eas-version: latest
  #         token: ${{ secrets.EXPO_TOKEN }}

  #     - name: üì¶ Install dependencies
  #       run: npm ci

  #     - name: üåé Compile translations
  #       run: npm run i18n:extract && npm run i18n:compile

  #     - name: üöÄ Build app
  #       run: eas build --platform ${{ inputs.platform }} --profile ${{ inputs.environment }} --non-interactive

  #     - name: ‚úÖ Notify slack success
  #       if: success()
  #       env:
  #         SLACK_BOT_TOKEN: ${{ secrets.SLACK_NOTIFICATIONS_BOT_TOKEN }}
  #       uses: voxmedia/github-action-slack-notify-build@v1
  #       with:
  #         channel: builds
  #         status: SUCCESS
  #         color: good

  #     - name: ‚ùå Notify slack fail
  #       if: failure()
  #       env:
  #         SLACK_BOT_TOKEN: ${{ secrets.SLACK_NOTIFICATIONS_BOT_TOKEN }}
  #       uses: voxmedia/github-action-slack-notify-build@v1
  #       with:
  #         channel: builds
  #         status: FAILED
  #         color: danger

  slackNotification:
    name: Slack Notification
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: builds
          SLACK_COLOR: ${{ job.status }}
          SLACK_ICON: ${{ github.event.organization.avatar_url }}
          SLACK_MESSAGE: 'The test build was successfull :rocket:'
          SLACK_TITLE: Build Notification for ${{ inputs.platform }}
          SLACK_USERNAME: ${{ github.event.repository.name }} - ${{ github.workflow }}
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
