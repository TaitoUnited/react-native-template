name: Trigger EAS Update

on:
  pull_request:
    types: [labeled]

jobs:
  update:
    name: Update Preview Branch
    runs-on: ubuntu-latest
    if: contains(github.event.label.name, 'eas-update')
    steps:
      - name: ⬇️ Setup repo
        uses: actions/checkout@v4

      - name: 📦 Install
        uses: ./.github/actions/install
        with:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: 🌎 Compile translations
        run: npm run i18n:extract && npm run i18n:compile

      - name: 🚀 Create preview
        uses: expo/expo-github-action/preview@v8
        id: preview
        with:
          command: eas update --branch ${{ github.head_ref }} --message "${{ github.event.pull_request.title }}" --non-interactive
